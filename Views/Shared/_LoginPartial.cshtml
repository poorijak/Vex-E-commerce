@using Microsoft.AspNetCore.Identity
@inject SignInManager<Customer> SignInManager
@inject UserManager<Customer> UserManager

<div class="flex gap-3">
    @if (SignInManager.IsSignedIn(User))
    {
        var user = await UserManager.GetUserAsync(User);
        var pictureProfile = user?.ProfilePictureUrl ?? "https://avatars.githubusercontent.com/u/124599?v=4";


        <div class="flex items-center justify-center gap-8">
            <a href="/cart" class="flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="#000000" viewBox="0 0 256 256"><path d="M104,216a16,16,0,1,1-16-16A16,16,0,0,1,104,216Zm88-16a16,16,0,1,0,16,16A16,16,0,0,0,192,200ZM239.71,74.14l-25.64,92.28A24.06,24.06,0,0,1,191,184H92.16A24.06,24.06,0,0,1,69,166.42L33.92,40H16a8,8,0,0,1,0-16H40a8,8,0,0,1,7.71,5.86L57.19,64H232a8,8,0,0,1,7.71,10.14ZM221.47,80H61.64l22.81,82.14A8,8,0,0,0,92.16,168H191a8,8,0,0,0,7.71-5.86Z"></path></svg>
            </a>
            <a href="/whitlist" class="flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="#000000" viewBox="0 0 256 256"><path d="M178,40c-20.65,0-38.73,8.88-50,23.89C116.73,48.88,98.65,40,78,40a62.07,62.07,0,0,0-62,62c0,70,103.79,126.66,108.21,129a8,8,0,0,0,7.58,0C136.21,228.66,240,172,240,102A62.07,62.07,0,0,0,178,40ZM128,214.8C109.74,204.16,32,155.69,32,102A46.06,46.06,0,0,1,78,56c19.45,0,35.78,10.36,42.6,27a8,8,0,0,0,14.8,0c6.82-16.67,23.15-27,42.6-27a46.06,46.06,0,0,1,46,46C224,155.61,146.24,204.15,128,214.8Z"></path></svg>
            </a>

            <div class="relative inline-block text-left transition-all duration-150">

                <img id="admin-menu-button"
                     class="size-8 cursor-pointer rounded-full"
                     src="@pictureProfile"
                     alt="Profile Picture"
                     aria-expanded="false"
                     aria-haspopup="true" />

                <div id="admin-menu-items"
                     class="absolute right-0 z-10 mt-2 hidden w-56 origin-top-right bg-white shadow-md ring-1 ring-border focus:outline-none"
                     role="menu"
                     aria-orientation="vertical"
                     aria-labelledby="admin-menu-button"
                     tabindex="-1">

                    <div class="p-1 font-medium" role="none">
                        <a href="@Url.Action("Settings", "Admin")" class="flex items-center gap-2 px-4 py-2 text-sm hover:bg-gray-100" role="menuitem" tabindex="-1">
                            Admin
                        </a>
                        <div class="h-px flex-1 bg-border"></div>
                        <form asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Action("Index", "Home", new { area = "" })" class="block w-full">
                            <button type="submit" class="flex w-full items-center gap-2 px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100" role="menuitem" tabindex="-1">
                                Sign out
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="flex items-center gap-5">
            <div>
                <a asp-area="Identity" class="border border-primary px-5 py-2 text-sm transition-colors duration-200 hover:cursor-pointer hover:bg-primary hover:text-white" asp-page="/Account/Login">Sign in</a>
            </div>
        </div>
    }
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const button = document.getElementById('admin-menu-button'); 
        const menu = document.getElementById('admin-menu-items');

        // ฟังก์ชันสำหรับสลับการแสดงผล (ใช้ได้เหมือนเดิม)
        button.addEventListener('click', function() {
            menu.classList.toggle('hidden');
        });

        // ฟังก์ชันสำหรับปิด Dropdown เมื่อคลิกนอกพื้นที่ (ใช้ได้เหมือนเดิม)
        document.addEventListener('click', function(event) {
            // ตรวจสอบว่าการคลิกไม่ได้เกิดบนปุ่ม (รูปโปรไฟล์) และไม่ได้เกิดบนเมนู
            if (!button.contains(event.target) && !menu.contains(event.target)) {
                if (!menu.classList.contains('hidden')) {
                    menu.classList.add('hidden');
                }
            }
        });
    });
</script>