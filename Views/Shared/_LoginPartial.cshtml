@using Microsoft.AspNetCore.Identity
@inject SignInManager<Customer> SignInManager
@inject UserManager<Customer> UserManager

<div class="flex gap-3">
    @if (SignInManager.IsSignedIn(User))
    {
        var user = await UserManager.GetUserAsync(User);
        var pictureProfile = user?.ProfilePictureUrl ?? "https://avatars.githubusercontent.com/u/124599?v=4";

        <div class="flex items-center justify-center gap-4">
            <a href="/cart" class="flex items-center justify-center">
                <i class="ph ph-shopping-cart-simple text-2xl"></i>
            </a>
            <a href="/Wishlist" class="flex items-center justify-center">
                <i class="ph ph-heart text-2xl"></i>
            </a>

            <div class="relative inline-block text-left transition-all duration-150">

                <img id="admin-menu-button"
                     class="size-8 cursor-pointer rounded-full"
                     src="@pictureProfile"
                     alt="Profile Picture"
                     aria-expanded="false"
                     aria-haspopup="true" />

                <div id="admin-menu-items"
                     class="absolute right-0 z-10 mt-2 hidden w-56 origin-top-right bg-white shadow-md ring-1 ring-border focus:outline-none"
                     role="menu"
                     aria-orientation="vertical"
                     aria-labelledby="admin-menu-button"
                     tabindex="-1">

                    <div class="flex flex-col gap-3 p-1 font-medium" role="none">
                        <div class="mt-3 flex flex-col items-center justify-center gap-3">
                            <img class="size-20 rounded-full"
                                 src="@pictureProfile"
                                 alt="Profile Picture"
                                 aria-expanded="false"
                                 aria-haspopup="true" />
                            @if (user.Role.ToString() == "Admin")
                            {
                                <p class="flex items-center gap-3">
                                    <i class="ph-fill ph-crown text-lg text-yellow-400"></i>
                                    Admin
                                </p>
                            }
                            <p class="text-center text-sm">@user.Email</p>
                            
                        </div>
                       <div class="mt-3">
                           <div class="mb-3 ml-2">
                               <p class="text-sm underline">Menu</p>
                           </div>
                            @* <div class="mx-3 h-px flex-1 bg-border"></div> *@
                            @if(user.Role.ToString() == "Admin")
                            {
                                <a asp-controller="Admin" asp-action="Index" class="flex items-center gap-2 rounded-sm px-4 py-2 text-sm hover:bg-gray-100" role="menuitem" tabindex="-1">
                                    <i class="ph ph-wrench"></i>
                                    Admin
                                </a>
                            }
                            <div class="my-1 h-px flex-1 bg-border"></div>
                            <form asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Action("Index", "Home", new { area = "" })" class="block w-full">
                                <button type="submit" class="flex w-full items-center gap-2 rounded-sm px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-100" role="menuitem" tabindex="-1">
                                    <i class='bxr bx-arrow-out-right-square-half'></i>
                                    Sign out
                                </button>
                            </form>
                       </div>
                    </div>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="flex items-center gap-5">
            <div>
                <a asp-area="Identity" class="border border-primary px-5 py-2 text-sm transition-colors duration-200 hover:cursor-pointer hover:bg-primary hover:text-white" asp-page="/Account/Login">Sign in</a>
            </div>
        </div>
    }
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const button = document.getElementById('admin-menu-button'); 
        const menu = document.getElementById('admin-menu-items');

        // ฟังก์ชันสำหรับสลับการแสดงผล (ใช้ได้เหมือนเดิม)
        button.addEventListener('click', function() {
            menu.classList.toggle('hidden');
        });

        // ฟังก์ชันสำหรับปิด Dropdown เมื่อคลิกนอกพื้นที่ (ใช้ได้เหมือนเดิม)
        document.addEventListener('click', function(event) {
            // ตรวจสอบว่าการคลิกไม่ได้เกิดบนปุ่ม (รูปโปรไฟล์) และไม่ได้เกิดบนเมนู
            if (!button.contains(event.target) && !menu.contains(event.target)) {
                if (!menu.classList.contains('hidden')) {
                    menu.classList.add('hidden');
                }
            }
        });
    });
</script>