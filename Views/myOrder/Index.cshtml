@model Vex_E_commerce.Models.OrderDetailVm

@{

    int index = 1;

    Layout = "~/Views/Shared/_ProtectLayout.cshtml";

    string statusBadgeClass = "";
    string statusLabel = Model.Status.ToString().ToUpper(); // แปลงเป็นตัวพิมพ์ใหญ่

    switch (Model.Status)
    {
        case Vex_E_commerce.Models.OrderStatus.pending:
            // สีเหลือง: รอตรวจสอบ
            statusBadgeClass = "bg-yellow-100 text-yellow-700 border-yellow-200";
            break;

        case Vex_E_commerce.Models.OrderStatus.paid:
            // สีฟ้า: จ่ายแล้ว/รอส่ง
            statusBadgeClass = "bg-blue-100 text-blue-700 border-blue-200";
            break;

        case Vex_E_commerce.Models.OrderStatus.shipped:
            // สีม่วง/คราม: อยู่ระหว่างขนส่ง
            statusBadgeClass = "bg-indigo-100 text-indigo-700 border-indigo-200";
            break;

        case Vex_E_commerce.Models.OrderStatus.delivered:
            // สีเขียว: สำเร็จ
            statusBadgeClass = "bg-green-100 text-green-700 border-green-200";
            break;

        case Vex_E_commerce.Models.OrderStatus.cancelled:
            // สีแดง: ยกเลิก
            statusBadgeClass = "bg-red-100 text-red-700 border-red-200";
            break;

        default:
            statusBadgeClass = "bg-gray-100 text-gray-700 border-gray-200";
            break;
    }

}
    

<div class="font-geist mx-5 pt-44 md:mx-30 md:pt-30">
    <div>
       <div class="flex flex-col gap-2">
            <h1 class="text-xl font-bold md:text-2xl">OrderId - #@Model.OrderNumber</h1>
            <div class="flex items-center gap-3">
                <p class="text-muted-foreground">Order date <span class="font-medium text-primary">@Model.CreatedAt</span></p>
                <div>
                    <span class="rounded-full border px-3 py-1 text-xs font-semibold @statusBadgeClass">
                        @statusLabel
                    </span>
                </div>
            </div>
       </div>
        <p></p>
    </div>
    <div class="mt-10 grid grid-cols-1 gap-3 md:grid-cols-5">
        <div class="col-span-1 flex flex-col gap-3 md:col-span-3">
            <section class="flex flex-col gap-2 rounded-md border border-border bg-white p-5">
                <h2 class="text-xl font-bold">Order Detail</h2>
                <div class="h-px border-b border-border"></div>
                <div class="mt-2">
                    @for (int i = 0; i < Model.Items.Count; i++)
                    {
                        var item = Model.Items[i];
                        <div class="flex items-center justify-between gap-5">
                            <div class="flex items-center gap-5">
                                <span>@(i + 1)</span>
                                <img src="@item.PictureUrl" class="size-14 object-cover" />
                                <div class="flex flex-col gap-1">
                                    <p class="text-lg font-semibold">@item.ProductTitle</p>
                                    <p class="text-muted-foreground text-sm">@item.VariantText</p>
                                </div>
                            </div>

                            <div class="flex items-center gap-10">
                                <p>x @item.Quantity</p>
                                <p>@item.UnitPrice ฿</p>
                            </div>
                        </div>

                        @if (i < Model.Items.Count - 1)
                        {
                            <div class="my-4 h-px border-b border-border"></div>
                        }
                    }

                </div>
            </section>

            <section class="flex flex-col gap-2 rounded-md border border-border bg-white p-5">
                <h2 class="text-xl font-bold">Address Infomation</h2>
                <div class="h-px border-b border-border"></div>
                <div class="mt-2 grid grid-cols-2 gap-3">
                    <div>
                        <label class="text-muted-foreground text-xs">Name : </label>
                        <p class="text-base font-semibold">@Model.Address.Name</p>
                    </div>
                    <div>
                        <label class="text-muted-foreground text-xs">Phone : </label>
                        <p class="text-base font-semibold">@Model.Address.Phone</p>
                    </div>
                    <div>
                        <label class="text-muted-foreground text-xs">AddressDetail : </label>
                        <p class="text-base font-semibold">@Model.Address.AddressDetail</p>
                    </div>
                    <div>
                        <label class="text-muted-foreground text-xs">Province : </label>
                        <p class="text-base font-semibold">@Model.Address.Province</p>
                    </div>
                    <div>
                        <label class="text-muted-foreground text-xs">Postal Code : </label>
                        <p class="text-base font-semibold">@Model.Address.PostalCode</p>
                    </div>
                    
                </div>

                <div>
                    <label class="text-muted-foreground text-xs">Note : </label>
                    <p class="text-base font-semibold">@Model.Address.Note</p>
                </div>
            </section>
        </div>
        <div class="col-span-1 md:col-span-2">
            <section class="rounded-md border border-border bg-white p-5">
                <h2 class="text-xl font-bold">Order Summary</h2>
                <div class="my-3 h-px border-b border-border"></div>
                <div class="flex flex-col gap-10">
                    <div class="flex flex-col gap-3">
                        <div class="flex items-center justify-between">
                            <label class="text-muted-foreground">Subtotal : </label>
                            <p class="font-semibold">@Model.ItemsTotal ฿</p>
                        </div>
                        <div class="h-px border-b border-border"></div>
                        <div class="flex items-center justify-between">
                            <label class="text-muted-foreground">Shipping Fee : </label>
                            <p class="font-semibold">@Model.ShippingFee ฿</p>
                        </div>
                        <div class="flex items-center justify-between">
                            <label class="text-muted-foreground">Tax : </label>
                            <p class="font-semibold">@Model.Tax ฿</p>
                        </div>
                        <div class="h-px border-b border-border"></div>
                        <div class="flex items-center justify-between">
                            <label class="font-semibold text-primary">Total : </label>
                            <p class="font-semibold">@Model.TotalAmount ฿</p>
                        </div>
                    </div>

                  

                    @if(string.IsNullOrEmpty(Model.PaymentImageUrl))
                    {

                        <div>
                            <button class="btn-qr flex w-full items-center justify-center gap-4 border-[0.5px] border-primary bg-primary px-4 py-2 text-white transition-colors duration-200 hover:cursor-pointer hover:border-primary hover:bg-transparent hover:text-primary">Scan PromptPay</button>
                        </div>

                        <div class="font-geist payment-section hidden">
                            <h2 class="text-xl font-bold">Payment method</h2>
                            <div class="my-3 h-px border-b border-border"></div>

                            <div class="mt-10 flex flex-col items-center gap-3">
                                <p class="text-center text-sm font-medium">Please scan Qr for payment <br /> or save Qr image & upload to your banking application</p>
                                <img class="size-60 object-cover" src="https://promptpay.io/@ViewBag.Phone/@Model.TotalAmount">

                                <div class="w-full">
                                    <form asp-controller="myOrder"
                                          asp-action="UploadSlip"
                                          method="post"
                                          enctype="multipart/form-data">

                                        @Html.AntiForgeryToken()
                                        <input type="hidden" name="orderId" value="@Model.OrderId" />

                                        <label class="text-lg font-semibold">Upload Slip</label>
                                        <div class="my-3 h-px border-b border-border"></div>

                                        <input asp-for="PaymentFile"
                                               type="file"
                                               class="w-full rounded border border-border px-3 py-2 text-sm" accept="image/*" />


                                        <span asp-validation-for="PaymentFile" class="text-xs text-red-500"></span>

                                        <button type="submit"
                                                class="mt-3 flex w-full items-center justify-center gap-4 border-[0.5px] border-primary bg-primary px-4 py-2 text-white transition-colors duration-200 hover:cursor-pointer hover:border-primary hover:bg-transparent hover:text-primary">
                                            Upload Slip
                                        </button>
                                    </form>

                                </div>
                            </div>

                        </div>
                    } else
                    {

                        <div class="font-geist">
                            <h2 class="text-xl font-bold">Payment Confirmation</h2>
                            <div class="my-3 h-px border-b border-border"></div>

                            <div class="mt-10 flex flex-col items-center gap-3">
                                <img src="@Model.PaymentImageUrl" class="size-60 rounded-xs border border-border object-cover" />
                            </div>

                        </div>

                        
                    }
                </div>
            </section>
       </div>

        
        
    </div>
</div>

<script>
   const  promptpay_button = document.querySelector(".btn-qr")
   const  payment_Section = document.querySelector(".payment-section")


   promptpay_button.addEventListener("click" , () => {
       payment_Section.classList.toggle("hidden")
   })




</script>